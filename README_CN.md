# cryptoscallop

[English](README.md)|[中文]

<!-- TOC -->

- [1. 数据结构定义](#1-数据结构定义)
- [2. 角色定义](#2-角色定义)
- [3. 接口定义](#3-接口定义)
    - [3.1. adopt_scallop()](#31-adopt_scallop)
    - [3.2. sell_scallop()](#32-sell_scallop)
    - [3.3. buy_scallop()](#33-buy_scallop)
    - [3.4. auction_scallop()](#34-auction_scallop)
    - [3.5. lottery_scallop()](#35-lottery_scallop)
    - [3.6. query_balance()](#36-query_balance)
    - [3.7. set_img_path()](#37-set_img_path)
    - [3.8. get_img_path()](#38-get_img_path)

<!-- /TOC -->

## 1. 数据结构定义

枚一枚扇贝都具有一个唯一的扇贝基因数据结构`gene`，其定义如下：

- birth_time: Unix时间戳。
- raidus: 一个1到10的随机数，决定了扇贝的大小。
- card_color_index：卡牌背景色，随机从定义颜色集`ColorSet`中选取。
- main_color_index: 扇贝的主色，随机从预定义颜色集`ColorSet`中选取。
- muscle_color_index：扇贝肉的颜色，随机从预定义颜色集`ColorSet`中选取。
- id: 具有唯一性的扇贝编号，由`salt <- rand(1,100000)`，`id <- sha256(birth_time|raidus|main_color|salt)`生成。
- owner：扇贝的主人，由ONTID标识。
- is_sell：扇贝是否处于出售状态。
- img_path: 扇贝外观图在IPFS中的存储位置。

ColorSet中的数据定义如下：

| color unique index | color label  |  颜色名  |       RGB       |      CMYK      |
|:------------------:|:------------:|:--------:|:---------------:|:--------------:|
|         1          |     grey     |  鱼尾灰  |   (94,97,109)   | (64,52,39,28)  |
|         2          |    mauve     |  藤萝紫  |  (128,118,163)  |  (58,56,17,2)  |
|         3          |  aquamarine  |  亚丁绿  |  (66,134,117))  |  (88,24,61,9)  |
|         4          |    orange    | 万寿菊黄 |   (251,139,5)   |  (0,56,91,0)   |
|         5          |    sallow    |   土黄   |  (214,160,29)   |  (12,41,98,2)  |
|         6          |    salmon    |   肉色   |  (247,193,115)  |  (0,32,52,0)   |
|         7          | bananacream  |  香蕉黄  |  (228,191,17)   |  (11,25,99,1)  |
|         8          |  cloudwhite  |  云峰白  |  (216,227,231)  |  (21,6,10,0)   |
|         9          |  cloisonne   |  景泰蓝  |  (39,117,182)   |  (95,46,10,1)  |
|         10         |  cinderella  |  瓦罐灰  |   (71,72,76)    | (67,57,49,49)  |
|         11         |   oldlace    |   米色   | (249，223，205) |  (1,11,24,0)   |
|         12         |   brownies   |  淡咖啡  |   (148,88,51)   | (27,69,85,22)  |
|         13         |    nacho     |  琥珀黄  |   (254,186,7)   |  (0,34,93,0)   |
|         14         |     onyx     |  玛瑙灰  |  (207,204,201)  |  (21,17,19,1)  |
|         15         |  dragonfly   |  蜻蜓红  |   (241,68,29)   |  (0,81,84,0)   |
|         16         |   harbour    |   海青   |  (34,162,195)   |  (92,10,25,1)  |
|         17         |    cherry    |  樱桃红  |   (237,51,33)   |  (0,86,82,0)   |
|         18         |  verdigris   |   铜绿   |  (43,174,133)   |  (92,0,64,0)   |
|         19         |  redvelvet   |  茶花红  |   (238,63,77)   |  (0,84,60,0)   |
|         20         |     mint     |  薄荷绿  |   (32,127,76)   | (100,22,90,10) |
|         21         | fingeryellow |  佛手黄  |  (254,215,26)   |  (1,18,94,0)   |
|         22         |    tundra    |   苔绿   |  (136,115,34)   | (36,42,100,29) |
|         23         |   lavender   |  芝兰紫  |  (126,22,113)   |  (3,26,10,0)   |
|         24         |   martian    |  火砖红  |   (205,98,39)   |  (8,72,93,1)   |
|         25         |   glacier    |  冰山蓝  |  (164,172,167)  |  (40,24,32,6)  |
|         26         |   shamrock   |   鲜绿   |   (67,178,68)   |  (88,0,99,0)   |
|         27         |   hyacinth   |  丹紫红  |  (210,86,140)   |  (7,79,18,0)   |
|         28         |  blueglaze   |   釉蓝   |  (23,129,181)   |  (96,34,18,4)  |
|         29         |   sophora    | 槐花黄绿 |  (210,217,122)  |  (28,6,66,0)   |
|         30         |     pink     |   淡绯   |  (242,202,201)  |  (0,29,16,0)   |

## 2. 角色定义

在这个非同质扇贝游戏中，有三个角色：

- 管理员
- 买家
- 卖家
- 扇贝

## 3. 接口定义

### 3.1. adopt_scallop()

- 每次扇贝的领养，用户需要花费10个Magic Token（一种OEP4 Toekn）。
- 购买成功后，用户会得到一个随机的扇贝宝宝（具有随机的扇贝基因）。

### 3.2. sell_scallop()

- 扇贝所有者调用该接口将扇贝设置为卖出状态。
- 在该接口中，扇贝所有者可以选择卖出方式：
  - 拍卖：记时（默认为1小时）结束后，价高者得。
  - 随机卖出（设置一个固定的抽奖价格，计时结束后，抽奖池中的所有资金都归卖家，扇贝被随机送给投注者）。
  - 固定价格卖出：设定一个期望的成交价格。
- 该接口一旦执行成功，状态将不可回退。

### 3.3. buy_scallop()

- 购买者调用该接口进行固定价格扇贝的购买。
- 购买成功后，扇贝的owner将变为购买者的ONT ID，扇贝的卖家获得相应的Magic Token。

### 3.4. auction_scallop()

- 购买者调用该接口参与到扇贝的竞拍当中。
- 购买者需要提供将竞拍资金抵押到合约当中，当拍卖结束后：
  - 成功拍得的竞拍者获得扇贝。
  - 未成功拍得的竞拍者资金从合约中返还到他的账户中。

### 3.5. lottery_scallop()

- 购买者调用该接口参与到扇贝的随机卖出当中。
- 购买者需要为此支付指定金额的Magic Token作为参与费用。
- 记时结束后，随机赢家将获得扇贝。

### 3.6. query_balance()

- 查询账户地址所拥有的扇贝
- 扇贝信息以列表形式返回，每个列表中的元素为扇贝的编号。

### 3.7. set_img_path()

- 该接口仅供管理员调用。
- 该接口用于为扇贝设置其外观图在IPFS中的存储位置。

### 3.8. get_img_path()

该接口返回扇贝外观图在IPFS中的存储位置`img_path`。